/*
 Route360° JavaScript API v1.0.1 (36af649), a JS library for leaflet maps. http://route360.net
 (c) 2014 Henning Hollburg, Daniel Gerber and Jan Silbersiepe, (c) 2014 Motion Intelligence GmbH
*/
!function(t,e,n){function o(){var e=t.r360;a.noConflict=function(){return t.r360=e,this},t.r360=a}function r(t,e){this.map=t,this.id=this.map.getDiv().id,this.inverse=!1,this.topRight={lat:-90,lng:-180},this.bottomLeft={lat:90,lng:180},this.opacity=a.config.defaultPolygonLayerOptions.opacity,this.strokeWidth=a.config.defaultPolygonLayerOptions.strokeWidth,this.backgroundColor=a.config.defaultPolygonLayerOptions.backgroundColor,this.backgroundOpacity=a.config.defaultPolygonLayerOptions.backgroundOpacity,this.tolerance=a.config.defaultPolygonLayerOptions.tolerance,this.extendWidthX=a.config.defaultPolygonLayerOptions.strokeWidth/2,this.extendWidthY=a.config.defaultPolygonLayerOptions.strokeWidth/2,"undefined"!=typeof e&&("undefined"!=typeof e.opacity&&(this.opacity=e.opacity),"undefined"!=typeof e.strokeWidth&&(this.strokeWidth=e.strokeWidth),"undefined"!=typeof e.inverse&&(this.inverse=e.inverse),"undefined"!=typeof e.tolerance&&(this.tolerance=e.tolerance),"undefined"!=typeof e.extendWidthX&&(this.extendWidthX=e.extendWidthX),"undefined"!=typeof e.extendWidthY&&(this.extendWidthY=e.extendWidthY)),this.element=null,this.setMap(this.map),this.addListener()}var a={version:"v1.0.1",isUndefined:function(t){return void 0===t},has:function(t,e){return null!=t&&hasOwnProperty.call(t,e)},isFunction:function(t){return"function"==typeof t||!1},findWhere:function(t,e){var i=n;return t.some(function(t,n,o){var r=!1;for(var n in e)r=a.has(t,n)&&t[n]===e[n]?!0:!1;return r?(i=t,!0):void 0}),i},filter:function(t,e){var i=[];return t.forEach(function(t,n,o){e(t,n,o)&&i.push(t)}),i},contains:function(t,e){return t.indexOf(e)>-1},each:function(t,e){t.forEach(function(t,i,n){e(t,i,n)})},max:function(t,e,i){var n,o,r=-(1/0),s=-(1/0);if(null==e||"number"==typeof e&&"arrayect"!=typeof t[0]&&null!=t)for(var l=0,h=t.length;h>l;l++)n=t[l],null!=n&&n>r&&(r=n);else a.each(t,function(t,i,n){o=e(t,i,n),(o>s||o===-(1/0)&&r===-(1/0))&&(r=t,s=o)});return r},keys:function(t){if("Object"!=typeof t)return[];if(Object.keys(t))return Object.keys(t);var e=[];for(var i in t)a.has(t,i)&&e.push(i);return e}};"object"==typeof module&&"object"==typeof module.exports?module.exports=a:"function"==typeof define&&define.amd?define(a):o(),Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),i=this,n=function(){},o=function(){return i.apply(this instanceof n&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return n.prototype=this.prototype,o.prototype=new n,o}),a.config={serviceUrl:"https://api.route360.net/api_dev/",nominatimUrl:"https://geocode.route360.net/",osmServiceUrl:"https://api.route360.net/r360-osm-api-norway/",serviceVersion:"v1",pathSerializer:"compact",requestTimeout:1e4,maxRoutingTime:3600,bikeSpeed:15,bikeUphill:20,bikeDownhill:-10,walkSpeed:5,walkUphill:10,walkDownhill:0,travelTimes:[300,600,900,1200,1500,1800],travelType:"walk",logging:!1,defaultTravelTimeControlOptions:{travelTimes:[{time:300,color:"#006837",opacity:.1},{time:600,color:"#39B54A",opacity:.2},{time:900,color:"#8CC63F",opacity:.3},{time:1200,color:"#F7931E",opacity:.4},{time:1500,color:"#F15A24",opacity:.5},{time:1800,color:"#C1272D",opacity:1}],position:"topright",label:"travel time",initValue:30},routeTypes:[{routeType:"WALK",color:"red",haloColor:"white"},{routeType:"BIKE",color:"#558D54",haloColor:"white"},{routeType:"CAR",color:"#558D54",haloColor:"white"},{routeType:"TRANSFER",color:"#C1272D",haloColor:"white"},{routeType:102,color:"#006837",haloColor:"white"},{routeType:400,color:"#156ab8",haloColor:"white"},{routeType:900,color:"red",haloColor:"white"},{routeType:700,color:"#A3007C",haloColor:"white"},{routeType:1e3,color:"blue",haloColor:"white"},{routeType:109,color:"#006F35",haloColor:"white"},{routeType:100,color:"red",haloColor:"white"},{routeType:1,color:"red",haloColor:"red"},{routeType:2,color:"blue",haloColor:"blue"},{routeType:3,color:"yellow",haloColor:"yellow"},{routeType:0,color:"green",haloColor:"green"},{routeType:4,color:"orange",haloColor:"orange"},{routeType:5,color:"red",haloColor:"red"},{routeType:6,color:"blue",haloColor:"blue"},{routeType:7,color:"yellow",haloColor:"yellow"}],photonPlaceAutoCompleteOptions:{serviceUrl:"https://service.route360.net/geocode/",position:"topleft",reset:!1,reverse:!1,placeholder:"Select source",maxRows:5,width:300},defaultRadioOptions:{position:"topright"},defaultPolygonLayerOptions:{opacity:.4,strokeWidth:30,tolerance:15,backgroundColor:"black",backgroundOpacity:.5,inverse:!1,animate:!1,animationDuration:1},i18n:{language:"en",configuredLanguages:["en","de","no"],info:{en:"More information",de:"Mehr informationen",no:"Mer Informasjon"},fullscreen:{en:"Fullscreen",de:"Vollbild",no:"Fullskjerm"},slow:{en:"Slow",de:"Langsam",no:"Sakte"},low:{en:"Low",de:"Gering",no:"Lav"},medium:{en:"Medium",de:"Mittel",no:"Medium"},fast:{en:"Fast",de:"Schnell",no:"Raskt"},high:{en:"High",de:"Hoch",no:"Høy"},departure:{en:"Departure",de:"Abfahrt",no:"TODO TRANSLATION: "},placeholderSrc:{en:"Select source!",de:"Start wählen!",no:"Start"},placeholderTrg:{en:"Select target!",de:"Ziel wählen!",no:"Mål"},line:{en:"Line",de:"Linie",no:"TODO TRANSLATION: "},arrival:{en:"Arrival",de:"Ankunft",no:"TODO TRANSLATION: "},from:{en:"From",de:"Von",no:"TODO TRANSLATION: "},to:{en:"To",de:"Nach",no:"TODO TRANSLATION: "},travelTime:{en:"Travel time",de:"Reisezeit",no:"Reisetid"},totalTime:{en:"Total time",de:"Gesamtzeit",no:"TODO TRANSLATION: "},batteryCapacity:{en:"Battery capacity",de:"Akkuleistung",no:"Batterikapasitet"},distance:{en:"Distance",de:"Distanz",no:"Avstand"},wait:{en:"Please wait!",de:"Bitte warten!",no:"Vennligst vent!"},polygonWait:{en:"Calculating reachable area!",de:"Berechne erreichbare Fläche!",no:"Vennligst vent!"},routeWait:{en:"Searching route to target(s)!",de:"Suche Route zum Ziel!",no:"Vennligst vent!"},timeWait:{en:"Getting travel times to target(s)!",de:"Berechne Reisezeiten für Ziele!",no:"Vennligst vent!"},osmWait:{en:"Searching for points of interests!",de:"Suche nach Sehenswürdigkeiten!",no:"Vennligst vent!"},populationWait:{en:"Calculating population statistics!",de:"Berechne Bevölkerungsstatistik!",no:"Vennligst vent!"},elevation:{en:"Elevation",de:"Höhenunterschied",no:"Stigning"},timeFormat:{en:"a.m.",de:"Uhr",no:"TODO_TRANSLATION"},reset:{en:"Reset input",de:"Eingeben löschen",no:"Reset"},reverse:{en:"Switch source and target",de:"Start und Ziel tauschen",no:"Motsatt"},settings:{en:"Switch travel type",de:"Reisemodus wechseln",no:"Reisemåte"},noRouteFound:{en:"No route found!",de:"Keine Route gefunden!",no:"TODO TRANSLATION"},monthNames:{en:["January","February","March","April","May","June","July","August","September","October","November","December"],de:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],no:["TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION"]},dayNames:{en:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],de:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],no:["TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION"]},dayNamesMin:{en:["Su","Mo","Tu","We","Th","Fr","Sa"],de:["So","Mo","Di","Mi","Do","Fr","Sa"],no:["TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION","TODO_TRANSLATION"]},museum:{en:"Museum",de:"Museum",no:"Museum"},swimming_pool:{en:"Swimming pool",de:"Schwimmbad",no:"Svømmebassenger"},restaurant:{en:"Restaurant",de:"Restaurant",no:"Restaurant"},cinema:{en:"Cinema",de:"Kino",no:"Kino"},theater:{en:"Theater",de:"Theater",no:"Teater"},library:{en:"Library",de:"Bibliothek",no:"Bibliotek"},bike_rental_station:{en:"Bike rental station",de:"Fahrradleihstation",no:"TODO TRANSLATION"},cycling_speed_help:{en:"Cycling speed: {}km/h",de:"Fahrradgeschwindigkeit: {}km/h",no:"G Fart: {}km/h, Fart: {}km/h"},walking_speed_help:{en:"Walk speed: {}km/h",de:"Laufgeschwindigkeit: {}km/h",no:"Fart: {}km/h"},walking_and_cycling_speed_help:{en:"Walk speed: {}km/h, Cycling speed: {}km/h",de:"Laufgeschwindigkeit: {}km/h, Fahrradgeschwindigkeit: {}km/h",no:"Fart: {}km/h (Gå), Fart: {}km/h (Sykle)"},ebike_speed_help_fast:{en:"Little support from the pedelec",de:"Keine Unterstützung durch das Pedelec",no:"Høy egeninnsats - Lav motorinnsats"},ebike_speed_help_medium:{en:"Medium support from the pedelec",de:"Mittlere Unterstützung durch das Pedelec",no:"Medium egeninnsats - Medium motorinnsats"},ebike_speed_help_slow:{en:"Full support from the pedelec",de:"Volle Unterstützung durch das Pedelec",no:"Lav egeninnsats - Høy motorinnsats"},contribution:{en:"Personal contribution",de:"Eigenleistung",no:"Egeninnsats"},low_contribution:{en:"Low personal contribution",de:"Geringe Eigenleistung",no:"Lav Egeninnsats"},switchLanguage:function(){var t=[];_.each(a.config.i18n.configuredLanguages,function(e){t.push("[lang='"+e+"']")}),$(t.join(", ")).hide(),$("[lang='"+a.config.i18n.language+"']").show()},getSpan:function(t){var e="";return _.each(_.keys(a.config.i18n[t]),function(i){e+='<span lang="'+i+'">'+a.config.i18n[t][i]+"</span>"}),e},getSpan:function(t,e){var i="";return _.each(_.keys(a.config.i18n[t]),function(n){var o=a.config.i18n[t][n];_.each(e,function(t){o=o.replace("{}",t)}),i+='<span lang="'+n+'">'+o+"</span>"}),""==i?"_"+t+"_":i},get:function(t){var e;return _.each(_.keys(a.config.i18n),function(i){t==i&&(e=a.config.i18n[t][a.config.i18n.language])}),e}}},a.Bounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},a.Bounds.prototype={extend:function(t){return t=a.point(t),this.min||this.max?(this.min.x=Math.min(t.x,this.min.x),this.max.x=Math.max(t.x,this.max.x),this.min.y=Math.min(t.y,this.min.y),this.max.y=Math.max(t.y,this.max.y)):(this.min=t.clone(),this.max=t.clone()),this},getCenter:function(t){return new a.Point((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return new a.Point(this.min.x,this.max.y)},getTopRight:function(){return new a.Point(this.max.x,this.min.y)},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,i;return t="number"==typeof t[0]||t instanceof a.Point?a.point(t):a.bounds(t),t instanceof a.Bounds?(e=t.min,i=t.max):e=i=t,e.x>=this.min.x&&i.x<=this.max.x&&e.y>=this.min.y&&i.y<=this.max.y},intersects:function(t){t=a.bounds(t);var e=this.min,i=this.max,n=t.min,o=t.max,r=o.x>=e.x&&n.x<=i.x,s=o.y>=e.y&&n.y<=i.y;return r&&s},overlaps:function(t){t=a.bounds(t);var e=this.min,i=this.max,n=t.min,o=t.max,r=o.x>e.x&&n.x<i.x,s=o.y>e.y&&n.y<i.y;return r&&s},isValid:function(){return!(!this.min||!this.max)}},a.bounds=function(t,e){return!t||t instanceof a.Bounds?t:new a.Bounds(t,e)},a.LatLngBounds=function(t,e){if(t)for(var i=e?[t,e]:t,n=0,o=i.length;o>n;n++)this.extend(i[n])},a.LatLngBounds.prototype={extend:function(t){var e,i,n=this._southWest,o=this._northEast;if(t instanceof a.LatLng)e=t,i=t;else{if(!(t instanceof a.LatLngBounds))return t?this.extend(a.latLng(t)||a.latLngBounds(t)):this;if(e=t._southWest,i=t._northEast,!e||!i)return this}return n||o?(n.lat=Math.min(e.lat,n.lat),n.lng=Math.min(e.lng,n.lng),o.lat=Math.max(i.lat,o.lat),o.lng=Math.max(i.lng,o.lng)):(this._southWest=new a.LatLng(e.lat,e.lng),this._northEast=new a.LatLng(i.lat,i.lng)),this},pad:function(t){var e=this._southWest,i=this._northEast,n=Math.abs(e.lat-i.lat)*t,o=Math.abs(e.lng-i.lng)*t;return new a.LatLngBounds(new a.LatLng(e.lat-n,e.lng-o),new a.LatLng(i.lat+n,i.lng+o))},getCenter:function(){return new a.LatLng((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new a.LatLng(this.getNorth(),this.getWest())},getSouthEast:function(){return new a.LatLng(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){t="number"==typeof t[0]||t instanceof a.LatLng?a.latLng(t):a.latLngBounds(t);var e,i,n=this._southWest,o=this._northEast;return t instanceof a.LatLngBounds?(e=t.getSouthWest(),i=t.getNorthEast()):e=i=t,e.lat>=n.lat&&i.lat<=o.lat&&e.lng>=n.lng&&i.lng<=o.lng},intersects:function(t){t=a.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),r=o.lat>=e.lat&&n.lat<=i.lat,s=o.lng>=e.lng&&n.lng<=i.lng;return r&&s},overlaps:function(t){t=a.latLngBounds(t);var e=this._southWest,i=this._northEast,n=t.getSouthWest(),o=t.getNorthEast(),r=o.lat>e.lat&&n.lat<i.lat,s=o.lng>e.lng&&n.lng<i.lng;return r&&s},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t){return t?(t=a.latLngBounds(t),this._southWest.equals(t.getSouthWest())&&this._northEast.equals(t.getNorthEast())):!1},isValid:function(){return!(!this._southWest||!this._northEast)}},a.latLngBounds=function(t,e){return!t||t instanceof a.LatLngBounds?t:new a.LatLngBounds(t,e)},a.Point=function(t,e,i){this.x=i?Math.round(t):t,this.y=i?Math.round(e):e},a.Point.prototype={clone:function(){return new a.Point(this.x,this.y)},add:function(t){return this.clone()._add(a.point(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(a.point(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},distanceTo:function(t){t=a.point(t);var e=t.x-this.x,i=t.y-this.y;return Math.sqrt(e*e+i*i)},equals:function(t){return t=a.point(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=a.point(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+a.Util.formatNum(this.x)+", "+a.Util.formatNum(this.y)+")"}},a.point=function(t,e,i){return t instanceof a.Point?t:a.Util.isArray(t)?new a.Point(t[0],t[1]):t===n||null===t?t:new a.Point(t,e,i)},a.LatLng=function(t,e,i){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,i!==n&&(this.alt=+i)},a.LatLng.prototype={equals:function(t,e){if(!t)return!1;t=a.latLng(t);var i=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return(e===n?1e-9:e)>=i},toString:function(t){return"LatLng("+a.Util.formatNum(this.lat,t)+", "+a.Util.formatNum(this.lng,t)+")"},distanceTo:function(t){return a.CRS.Earth.distance(this,a.latLng(t))},wrap:function(){return a.CRS.Earth.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,i=e/Math.cos(Math.PI/180*this.lat);return a.latLngBounds([this.lat-e,this.lng-i],[this.lat+e,this.lng+i])},clone:function(){return new a.LatLng(this.lat,this.lng,this.alt)}},a.latLng=function(t,e,i){return t instanceof a.LatLng?t:a.Util.isArray(t)&&"object"!=typeof t[0]?3===t.length?new a.LatLng(t[0],t[1],t[2]):2===t.length?new a.LatLng(t[0],t[1]):null:t===n||null===t?t:"object"==typeof t&&"lat"in t?new a.LatLng(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===n?null:new a.LatLng(t,e,i)},function(){var i=navigator.userAgent.toLowerCase(),n=e.documentElement,o="ActiveXObject"in t,r=-1!==i.indexOf("webkit"),s=-1!==i.indexOf("phantom"),l=-1!==i.search("android [23]"),h=-1!==i.indexOf("chrome"),g=-1!==i.indexOf("gecko")&&!r&&!t.opera&&!o,u="undefined"!=typeof orientation||-1!==i.indexOf("mobile"),d=navigator.msPointerEnabled&&navigator.msMaxTouchPoints&&!t.PointerEvent,c=t.PointerEvent&&navigator.pointerEnabled&&navigator.maxTouchPoints||d,p=o&&"transition"in n.style,f="WebKitCSSMatrix"in t&&"m11"in new t.WebKitCSSMatrix&&!l,m="MozPerspective"in n.style,y="OTransition"in n.style,v=!t.L_NO_TOUCH&&!s&&(c||"ontouchstart"in t||t.DocumentTouch&&e instanceof t.DocumentTouch);a.Browser={ie:o,ielt9:o&&!e.addEventListener,webkit:r,gecko:g,android:-1!==i.indexOf("android"),android23:l,chrome:h,safari:!h&&-1!==i.indexOf("safari"),ie3d:p,webkit3d:f,gecko3d:m,opera12:y,any3d:!t.L_DISABLE_3D&&(p||f||m)&&!y&&!s,mobile:u,mobileWebkit:u&&r,mobileWebkit3d:u&&f,mobileOpera:u&&t.opera,mobileGecko:u&&g,touch:!!v,msPointer:!!d,pointer:!!c,retina:(t.devicePixelRatio||t.screen.deviceXDPI/t.screen.logicalXDPI)>1}}(),a.Class=function(){},a.Class.extend=function(t){var e=function(){this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},i=e.__super__=this.prototype,n=a.Util.create(i);n.constructor=e,e.prototype=n;for(var o in this)this.hasOwnProperty(o)&&"prototype"!==o&&(e[o]=this[o]);return t.statics&&(a.extend(e,t.statics),delete t.statics),t.includes&&(a.Util.extend.apply(null,[n].concat(t.includes)),delete t.includes),n.options&&(t.options=a.Util.extend(a.Util.create(n.options),t.options)),a.extend(n,t),n._initHooks=[],n.callInitHooks=function(){if(!this._initHooksCalled){i.callInitHooks&&i.callInitHooks.call(this),this._initHooksCalled=!0;for(var t=0,e=n._initHooks.length;e>t;t++)n._initHooks[t].call(this)}},e},a.Class.include=function(t){a.extend(this.prototype,t)},a.Class.mergeOptions=function(t){a.extend(this.prototype.options,t)},a.Class.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),i="function"==typeof t?t:function(){this[t].apply(this,e)};this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(i)},a.PolygonUtil={clip:function(t,e){var n,o,r,a,s=function(t){return(o[0]-n[0])*(t[1]-n[1])>(o[1]-n[1])*(t[0]-n[0])},l=function(){var t=[n[0]-o[0],n[1]-o[1]],e=[r[0]-a[0],r[1]-a[1]],i=n[0]*o[1]-n[1]*o[0],s=r[0]*a[1]-r[1]*a[0],l=1/(t[0]*e[1]-t[1]*e[0]);return[(i*e[0]-s*t[0])*l,(i*e[1]-s*t[1])*l]},h=t,n=e[e.length-1];for(j in e){var o=e[j],g=h;h=[],r=g[g.length-1];for(i in g){var a=g[i];s(a)?(s(r)||h.push(l()),h.push(a)):s(r)&&h.push(l()),r=a}n=o}return h},isCollinear:function(t,e,i){if(t.x==i.x&&t.y==i.y)return!1;if(t.x==e.x&&e.x==i.x)return!0;if(t.y==e.y&&e.y==i.y)return!0;var n=t.x*(e.y-i.y)+e.x*(i.y-t.y)+i.x*(t.y-e.y);return n<a.config.defaultPolygonLayerOptions.tolerance&&n>-a.config.defaultPolygonLayerOptions.tolerance&&t.x!=i.x&&t.y!=i.y?!0:!1},scale:function(t,e){return a.point(t.x*e,t.y*e)},subtract:function(t,e,i){return a.point(t.x-e,t.y-i)},divide:function(t,e){return a.point(t.x/e,t.y/e)},roundPoint:function(t){return t.x=Math.round(t.x),t.y=Math.round(t.y),t},buildPath:function(t,e){return[e,Math.round(t.x),Math.round(t.y)]},getEuclidianDistance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},getSvgFrame:function(t,e){return[["M",0,0],["L",t,0],["L",t,e],["L",0,e],["z"]]},extendBounds:function(t,e,i){var n=Math.ceil(e),o=Math.ceil(i);return t.max.x+=n,t.min.x-=n,t.max.y+=o,t.min.y-=o,t},addPolygonToMultiPolygon:function(t,e){var i=a.filter(t,function(t){return t.getTravelTime()==e.travelTime});if(i.length>0)i[0].addPolygon(e);else{var n=new a.multiPolygon;n.setTravelTime(e.travelTime),n.addPolygon(e),n.setColor(e.getColor()),n.setOpacity(e.getOpacity()),t.push(n)}}},a.SvgUtil={getGElement:function(t,e){var i=a.Util.generateId(),n=e.opacity;return"<g id="+i+" style='opacity:"+n+"'><path style='stroke: "+e.color+"; fill: "+e.color+" ; stroke-opacity: 1; stroke-width: "+e.strokeWidth+"; fill-opacity:1'd='"+t.toString().replace(/\,/g," ")+"'/></g>"},getInverseSvgElement:function(t,e){var i=a.PolygonUtil.getSvgFrame(e.svgWidth,e.svgHeight),n="<div id=svg_"+e.id+" style='"+a.Util.getTranslation(e.offset)+";''><svg height="+e.svgHeight+" width="+e.svgWidth+" style='fill:"+e.backgroundColor+" ; opacity: "+e.backgroundOpacity+"; stroke-width: "+e.strokeWidth+"; stroke-linejoin:round; stroke-linecap:round; fill-rule: evenodd' xmlns='http://www.w3.org/2000/svg'>",o="</svg></div>",r="<defs><mask id='mask_"+e.id+"'><path style='fill-opacity:1;stroke: white; fill:white;' d='"+i.toString().replace(/\,/g," ")+"'/>"+t.join("")+"</mask></defs>",s="<path style='mask: url(#mask_"+e.id+")' d='"+i.toString().replace(/\,/g," ")+"'/>";return n+s+r+o},getNormalSvgElement:function(t,e){var i="<div id=svg_"+e.id+" style='"+a.Util.getTranslation(e.offset)+";''><svg  height="+e.svgHeight+" width="+e.svgWidth+" style='fill:"+e.backgroundColor+" ; opacity: "+e.opacity+"; stroke-linejoin:round; stroke-linecap:round; fill-rule: evenodd' xmlns='http://www.w3.org/2000/svg'>",n="</svg></div>";return i+t.join("")+n},createSvgData:function(t,e){var i=[],n=a.PolygonUtil.scale(t.getTopRightDecimal(),e.scale),o=a.PolygonUtil.scale(t.getBottomLeftDecimal(),e.scale);o.x>e.bounds.max.x||n.x<e.bounds.min.x||n.y>e.bounds.max.y||o.y<e.bounds.min.y||a.SvgUtil.buildSVGPolygon(i,t.getOuterBoundary().getCoordinates(),e);for(var r=t.getInnerBoundary(),s=0;s<r.length;s++){var l=a.PolygonUtil.scale(r[s].getTopRightDecimal(),e.scale),h=a.PolygonUtil.scale(r[s].getBottomLeftDecimal(),e.scale);h.x>e.bounds.max.x||l.x<e.bounds.min.x||l.y>e.bounds.max.y||h.y<e.bounds.min.y||a.SvgUtil.buildSVGPolygon(i,r[s].getCoordinates(),e)}return i},buildSVGPolygon:function(t,e,i){for(var n,o,r,s,l,h=0,g=[[i.bounds.min.x,i.bounds.min.y],[i.bounds.max.x,i.bounds.min.y],[i.bounds.max.x,i.bounds.max.y],[i.bounds.min.x,i.bounds.max.y]],u=[],d=0;d<e.length;d++)n=a.PolygonUtil.scale(a.point(e[d].x,e[d].y),i.scale),l=d>0?a.PolygonUtil.getEuclidianDistance(r,n):i.tolerance,l>=i.tolerance&&(s=!1,h>2&&(s=a.PolygonUtil.isCollinear(o,r,n)),s?(u[u.length-1][0]=n.x,u[u.length-1][1]=n.y):(u.push([n.x,n.y]),o=r,r=n,h++));for(var c,p=a.PolygonUtil.clip(u,g),d=0;d<p.length;d++)n=a.PolygonUtil.subtract(a.point(p[d][0],p[d][1]),i.pixelOrigin.x+i.offset.x,i.pixelOrigin.y+i.offset.y),t.push(d>0?a.PolygonUtil.buildPath(n,"L"):a.PolygonUtil.buildPath(n,"M")),c=n;return t.length>0&&t.push(["z"]),t}},a.Util={getTimeInSeconds:function(){var t=new Date;return 3600*t.getHours()+60*t.getMinutes()+t.getSeconds()},getHoursAndMinutesInSeconds:function(){var t=new Date;return 3600*t.getHours()+60*t.getMinutes()},getCurrentDate:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,n=t.getDate()<10?"0"+t.getDate():t.getDate();return e+""+i+n},getTimeFormat:function(t){var e=a.config.i18n;return"en"==e.language&&t>=43200?"p.m.":e.get("timeFormat")},secondsToHoursAndMinutes:function(t){var e=(t/60).toFixed(0),i=Math.floor(e/60);e-=60*i;var n="";return 0!=i&&(n+=i+"h "),n+=e+"min"},secondsToTimeOfDay:function(t){var e=Math.floor(t/3600),i=Math.floor(t/60)-60*e;return t=t-3600*e-60*i,e+":"+("0"+i).slice(-2)+":"+("0"+t).slice(-2)},generateId:function(t){for(var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;(t?t:10)>n;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e},parseLatLonArray:function(t){for(var e=new Array,i=0;i<t.length;i++)e.push(new a.Point(t[i][0],t[i][1]));return e},getAddressByCoordinates:function(t,e,i){$.getJSON(a.config.nominatimUrl+"reverse.php?&format=json&lat="+t.lat+"&accept-language="+e+"&lon="+t.lng+"&json_callback=?",i)},formatReverseGeocoding:function(t){var e=[];a.has(t.address,"road")&&e.push(t.address.road),a.has(t.address,"house_number")&&e.push(t.address.house_number);var i=[];a.has(t.address,"postcode")&&i.push(t.address.postcode),a.has(t.address,"city")&&i.push(t.address.city);var n=[];return e.length>0&&n.push(e.join(" ")),i.length>0&&n.push(i.join(", ")),0==e.length&&0==i.length&&n.push(t.display_name),n.join(", ")},formatPhotonReverseGeocoding:function(t){var e=[];a.has(t,"name")&&e.push(t.name),a.has(t,"street")&&e.push(t.street),a.has(t,"housenumber")&&e.push(t.housenumber);var i=[];a.has(t,"postcode")&&i.push(t.postcode),a.has(t,"city")&&i.push(t.city);var n=[];return e.length>0&&n.push(e.join(" ")),i.length>0&&n.push(i.join(", ")),0==e.length&&0==i.length&&n.push("Reverse geocoding not possible."),n.join(", ")},parsePolygons:function(t){for(var e=[],i=0;i<t.length;i++)for(var n=t[i],o=0;o<n.polygons.length;o++){var r=n.polygons[o],s=a.polygon(r.travelTime,r.area,a.lineString(a.Util.parseLatLonArray(r.outerBoundary))),l=a.findWhere(a.config.defaultTravelTimeControlOptions.travelTimes,{time:s.getTravelTime()});s.setColor(a.isUndefined(l)?"#000000":l.color);var h=a.findWhere(a.config.defaultTravelTimeControlOptions.travelTimes,{time:s.getTravelTime()});if(s.setOpacity(a.isUndefined(h)?1:h.opacity),"undefined"!=typeof r.innerBoundary)for(var g=0;g<r.innerBoundary.length;g++)s.addInnerBoundary(a.lineString(a.Util.parseLatLonArray(r.innerBoundary[g])));a.PolygonUtil.addPolygonToMultiPolygon(e,s)}return e.sort(function(t,e){return e.getTravelTime()-t.getTravelTime()}),e},parseNetwork:function(t){return t},parseRoutes:function(t){for(var e=new Array,i=0;i<t.routes.length;i++)e.push(a.route(t.routes[i].travelTime,t.routes[i].segments));return e},webMercatorToLeaflet:function(t){return a.CRS.EPSG3857.transformation._transform(a.point(t.x/6378137,t.y/6378137))},webMercatorToLatLng:function(t,e){var i=a.CRS.EPSG3857.projection.unproject(new a.Point(t.x,t.y));return"undefined"!=typeof e?a.latLng([i.lat,i.lng,e]):i},latLngToWebMercator:function(t){var e=a.Projection.SphericalMercator.project(t);return e.x*=6378137,e.y*=6378137,e},getUserAgent:function(){var t,e=navigator.userAgent,i=e.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(i[1])?(t=/\brv[ :]+(\d+)/g.exec(e)||[],"IE "+(t[1]||"")):"Chrome"===i[1]&&(t=e.match(/\bOPR\/(\d+)/),null!=t)?"Opera "+t[1]:(i=i[2]?[i[1],i[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(t=e.match(/version\/(\d+)/i))&&i.splice(1,1,t[1]),i.join(" "))},isAnimated:function(){var t=getUserAgent();return-1!=t.indexOf("IE")?!1:-1!=t.indexOf("Safari")?!1:-1!=t.indexOf("Firefox")?!1:a.config.defaultPolygonLayerOptions.animate?!0:!1},getTranslation:function(t){var e=a.Util.getUserAgent();return-1!=e.indexOf("IE 9")?"transform:translate("+t.x+"px,"+t.y+"px)":-1!=e.indexOf("Safari")?"-webkit-transform:translate3d("+t.x+"px,"+t.y+"px,0px)":-1!=e.indexOf("Firefox")?"-moz-transform:translate3d("+t.x+"px,"+t.y+"px,0px)":"transform:translate3d("+t.x+"px,"+t.y+"px,0px)"},formatNum:function(t,e){var i=Math.pow(10,e||5);return Math.round(t*i)/i},isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},extend:function(t){var e,i,n,o;for(i=1,n=arguments.length;n>i;i++){o=arguments[i];for(e in o)t[e]=o[e]}return t}},a.extend=a.Util.extend,a.DomUtil={setPosition:function(t,e){a.Browser.any3d?a.DomUtil.setTransform(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")},setTransform:function(t,e,i){var n=e||new a.Point(0,0);t.style[a.DomUtil.TRANSFORM]="translate3d("+n.x+"px,"+n.y+"px,0)"+(i?" scale("+i+")":"")},testProp:function(t){for(var i=e.documentElement.style,n=0;n<t.length;n++)if(t[n]in i)return t[n];return!1}},function(){a.DomUtil.TRANSFORM=a.DomUtil.testProp(["transform","WebkitTransform","OTransform","MozTransform","msTransform"])}(),a.TravelOptions=function(){this.sources=[],this.targets=[],this.service,this.bikeSpeed=n,this.bikeUphill=n,this.bikeDownhill=n,this.walkSpeed=n,this.walkUphill=n,this.walkDownhill=n,this.supportWatts=n,this.renderWatts=n,this.travelTimes=n,this.travelType=n,this.elevationEnabled=n,this.minPolygonHoleSize=n,this.time=n,this.date=n,this.recommendations=n,this.errors=[],this.x=n,this.y=n,this.z=n,this.intersectionMode=n,this.pathSerializer=a.config.pathSerializer,this.polygonSerializer="json",this.pointReduction=!0,this.maxRoutingTime=n,this.serviceUrl=n,this.serviceKey=n,this.waitControl,this.isValidPolygonServiceOptions=function(t){return this.errors=[],"[object Array]"===Object.prototype.toString.call(this.getSources())?0==this.getSources().length?this.getErrors().push("Sources do not contain any points!"):this.getSources().forEach(function(t){a.has(t,"lat")||"function"==typeof t.getLatLng||this.getErrors().push("Sources contains source with undefined latitude!"),a.has(t,"lon")||a.has(t,"lng")||"function"==typeof t.getLatLng||this.getErrors().push("Sources contains source with undefined longitude!")}):this.getErrors().push("Sources are not of type array!"),a.contains(["bike","transit","walk","car","rentbike","rentandreturnbike","ebike"],this.getTravelType())?"car"==this.getTravelType()||("bike"==this.getTravelType()||"rentbike"==this.getTravelType()||"rentandreturnbike"==this.getTravelType()?(""!=typeof this.getBikeUphill()&&""!=typeof this.getBikeDownhill()&&"undefined"!=typeof this.getBikeUphill()&&(this.getBikeUphill()<0||this.getBikeDownhill()>0||this.getBikeUphill()<-this.getBikeDownhill())&&this.getErrors().push("Uphill cycle speed has to be larger then 0. Downhill cycle speed has to be smaller then 0.                             Absolute value of downhill cycle speed needs to be smaller then uphill cycle speed."),this.getBikeSpeed()<=0&&this.getErrors().push("Bike speed needs to be larger then 0.")):"walk"==this.getTravelType()?(""!=typeof this.getBikeUphill()&&""!=typeof this.getBikeDownhill()&&"undefined"!=typeof this.getBikeUphill()&&(this.getWalkUphill()<0||this.getWalkDownhill()>0||this.getWalkUphill()<-this.getWalkDownhill())&&this.getErrors().push("Uphill walking speed has to be larger then 0. Downhill walking speed has to be smaller then 0.                             Absolute value of downhill walking speed needs to be smaller then uphill walking speed."),this.getWalkSpeed()<=0&&this.getErrors().push("Walk speed needs to be larger then 0.")):"transit"==this.getTravelType()):this.getErrors().push("Not supported travel type given: "+this.getTravelType()),t||("undefined"==typeof this.getTravelTimes()||"[object Array]"!==Object.prototype.toString.call(this.getTravelTimes())?this.getErrors().push("Travel times have to be an array!"):a.filter(this.getTravelTimes(),function(t){return"number"!=typeof t}).length>0&&this.getErrors().push("Travel times contain non number entries: "+this.getTravelTimes())),0==this.errors.length},this.isValidRouteServiceOptions=function(){return this.isValidPolygonServiceOptions(!0),"[object Array]"===Object.prototype.toString.call(this.getTargets())?0==this.getTargets().length?this.getErrors().push("Sources do not contain any points!"):this.getTargets().forEach(function(t){a.has(t,"lat")||"function"==typeof t.getLatLng||this.getErrors().push("Targets contains target with undefined latitude!"),a.has(t,"lon")||a.has(t,"lng")||"function"==typeof t.getLatLng||this.getErrors().push("Targets contains target with undefined longitude!")}):this.getErrors().push("Targets are not of type array!"),a.contains(["travelTime","compact","detailed"],this.getPathSerializer())||this.getErrors().push("Path serializer not supported: "+this.getPathSerializer()),0==this.errors.length},this.isValidTimeServiceOptions=function(){return this.isValidRouteServiceOptions(),a.contains(["travelTime","compact","detailed"],this.getPathSerializer())||this.getErrors().push("Path serializer not supported: "+this.getPathSerializer()),0==this.errors.length},this.getErrors=function(){return this.errors},this.getSources=function(){return this.sources},this.addSource=function(t){this.sources.push(t)},this.addTarget=function(t){this.targets.push(t)},this.getTargets=function(){return this.targets},this.getBikeSpeed=function(){
return this.bikeSpeed},this.getBikeUphill=function(){return this.bikeUphill},this.getBikeDownhill=function(){return this.bikeDownhill},this.getWalkSpeed=function(){return this.walkSpeed},this.getWalkUphill=function(){return this.walkUphill},this.getWalkDownhill=function(){return this.walkDownhill},this.getTravelTimes=function(){return this.travelTimes},this.getTravelType=function(){return this.travelType},this.getTime=function(){return this.time},this.getDate=function(){return this.date},this.getWaitControl=function(){return this.waitControl},this.getService=function(){return this.service},this.getPathSerializer=function(){return this.pathSerializer},this.getPolygonSerializer=function(){return this.polygonSerializer},this.getMaxRoutingTime=function(){return this.maxRoutingTime},this.getIntersectionMode=function(){return this.intersectionMode},this.getRecommendations=function(){return this.recommendations},this.getServiceUrl=function(){return this.serviceUrl},this.getServiceKey=function(){return this.serviceKey},this.setServiceKey=function(t){this.serviceKey=t},this.setServiceUrl=function(t){this.serviceUrl=t},this.setRecommendations=function(t){this.recommendations=t},this.setIntersectionMode=function(t){this.intersectionMode=t},this.setMaxRoutingTime=function(t){this.maxRoutingTime=t},this.setPathSerializer=function(t){this.pathSerializer=t},this.setPolygonSerializer=function(t){this.polygonSerializer=t},this.setService=function(t){this.service=t},this.setMinPolygonHoleSize=function(t){this.minPolygonHoleSize=t},this.getMinPolygonHoleSize=function(){return this.minPolygonHoleSize},this.setSources=function(t){this.sources=t},this.setTargets=function(t){this.targets=t},this.setBikeSpeed=function(t){this.bikeSpeed=t},this.setBikeUphill=function(t){this.bikeUphill=t},this.setBikeDownhill=function(t){this.bikeDownhill=t},this.setWalkSpeed=function(t){this.walkSpeed=t},this.setWalkUphill=function(t){this.walkUphill=t},this.setWalkDownhill=function(t){this.walkDownhill=t},this.setTravelTimes=function(t){this.travelTimes=t},this.setTravelType=function(t){this.travelType=t},this.setTime=function(t){this.time=t},this.setDate=function(t){this.date=t},this.setWaitControl=function(t){this.waitControl=t},this.isElevationEnabled=function(){return this.elevationEnabled},this.setElevationEnabled=function(t){this.elevationEnabled=t},this.disablePointReduction=function(){this.pointReduction=!1},this.enablePointReduction=function(){this.pointReduction=!0},this.isPointReductionEnabled=function(){return this.pointReduction},this.setX=function(t){this.x=t},this.setY=function(t){this.y=t},this.setZ=function(t){this.z=t},this.getX=function(){return this.x},this.getY=function(){return this.y},this.getZ=function(){return this.z}},a.travelOptions=function(){return new a.TravelOptions},a.MobieService={cache:{},getCfg:function(t){var e={};return e.sources=[],e.x=t.getX(),e.y=t.getY(),e.z=t.getZ(),a.isUndefined(t.isElevationEnabled())||(e.elevation=t.isElevationEnabled()),a.isUndefined(t.getMaxRoutingTime())||(e.maxRoutingTime=t.getMaxRoutingTime()),t.getSources().forEach(function(i){var n={lat:a.has(i,"lat")?i.lat:i.getLatLng().lat,lng:a.has(i,"lon")?i.lon:a.has(i,"lng")?i.lng:i.getLatLng().lng,id:a.has(i,"id")?i.id:"",tm:{}},o=a.has(i,"travelType")?i.travelType:t.getTravelType();n.tm[o]={},("transit"==o||"biketransit"==o)&&(n.tm[o].frame={},a.isUndefined(t.getTime())||(n.tm[o].frame.time=t.getTime()),a.isUndefined(t.getDate())||(n.tm[o].frame.date=t.getDate())),"bike"==o&&(n.tm.bike={},a.isUndefined(t.getBikeSpeed())||(n.tm.bike.speed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.bike.uphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.bike.downhill=t.getBikeDownhill())),"walk"==o&&(n.tm.walk={},a.isUndefined(t.getWalkSpeed())||(n.tm.walk.speed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.walk.uphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.walk.downhill=t.getWalkDownhill())),e.sources.push(n)}),e},getGraph:function(t,e,i){var n=a.MobieService.getCfg(t);if(a.has(a.MobieService.cache,JSON.stringify(n)))t.getWaitControl()&&t.getWaitControl().hide(),e(a.Util.parseNetwork(a.MobieService.cache[JSON.stringify(n)]));else{var o=a.MobieService.getAjaxOptions(t,n,e,i);$.ajax(o)}},getAjaxOptions:function(t,e,i,n){var o="undefined"!=typeof t.getServiceUrl()?t.getServiceUrl():a.config.serviceUrl,r={url:o+a.config.serviceVersion+"/mobie?cfg="+encodeURIComponent(JSON.stringify(e))+"&cb=?&key="+t.getServiceKey(),timeout:a.config.requestTimeout,dataType:"json",type:"GET",success:function(o){t.getWaitControl()&&t.getWaitControl().hide(),a.has(o,"data")?"ok"==o.code?(a.MobieService.cache[JSON.stringify(e)]=o.data,i(a.Util.parseNetwork(o.data))):a.isFunction(n)&&n(o.code,o.message):(a.MobieService.cache[JSON.stringify(e)]=o,i(a.Util.parseNetwork(o)))},error:function(e){t.getWaitControl()&&t.getWaitControl().hide(),a.isFunction(n)&&(403==e.status?n("not-authorized",e.responseText):n("service-not-available","The travel time polygon service is currently not available, please try again later."))}};return r}},a.PolygonService={cache:{},getCfg:function(t){var e={};return e.sources=[],e.x=t.getX(),e.y=t.getY(),e.z=t.getZ(),a.isUndefined(t.isElevationEnabled())||(e.elevation=t.isElevationEnabled()),a.isUndefined(t.getTravelTimes())&&a.isUndefined(t.getIntersectionMode())&&a.isUndefined(t.getRenderWatts())&&a.isUndefined(t.getSupportWatts())||(e.polygon={},a.isUndefined(t.getTravelTimes())||(e.polygon.values=t.getTravelTimes()),a.isUndefined(t.getIntersectionMode())||(e.polygon.intersectionMode=t.getIntersectionMode()),a.isUndefined(t.getPolygonSerializer())||(e.polygon.serializer=t.getPolygonSerializer()),a.isUndefined(t.isPointReductionEnabled())||(e.polygon.pointReduction=t.isPointReductionEnabled()),a.isUndefined(t.getMinPolygonHoleSize())||(e.polygon.minPolygonHoleSize=t.getMinPolygonHoleSize())),t.getSources().forEach(function(i){var n={lat:a.has(i,"lat")?i.lat:i.getLatLng().lat,lng:a.has(i,"lon")?i.lon:a.has(i,"lng")?i.lng:i.getLatLng().lng,id:a.has(i,"id")?i.id:"",tm:{}},o=a.has(i,"travelType")?i.travelType:t.getTravelType();n.tm[o]={},("transit"==o||"biketransit"==o)&&(n.tm[o].frame={},a.isUndefined(t.getTime())||(n.tm[o].frame.time=t.getTime()),a.isUndefined(t.getDate())||(n.tm[o].frame.date=t.getDate())),"ebike"==o&&(n.tm.ebike={},a.isUndefined(t.getBikeSpeed())||(n.tm.ebike.speed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.ebike.uphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.ebike.downhill=t.getBikeDownhill())),"rentbike"==o&&(n.tm.rentbike={},a.isUndefined(t.getBikeSpeed())||(n.tm.rentbike.bikespeed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.rentbike.bikeuphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.rentbike.bikedownhill=t.getBikeDownhill()),a.isUndefined(t.getWalkSpeed())||(n.tm.rentbike.walkspeed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.rentbike.walkuphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.rentbike.walkdownhill=t.getWalkDownhill())),"rentandreturnbike"==o&&(n.tm.rentandreturnbike={},a.isUndefined(t.getBikeSpeed())||(n.tm.rentandreturnbike.bikespeed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.rentandreturnbike.bikeuphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.rentandreturnbike.bikedownhill=t.getBikeDownhill()),a.isUndefined(t.getWalkSpeed())||(n.tm.rentandreturnbike.walkspeed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.rentandreturnbike.walkuphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.rentandreturnbike.walkdownhill=t.getWalkDownhill())),"bike"==o&&(n.tm.bike={},a.isUndefined(t.getBikeSpeed())||(n.tm.bike.speed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.bike.uphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.bike.downhill=t.getBikeDownhill())),"walk"==o&&(n.tm.walk={},a.isUndefined(t.getWalkSpeed())||(n.tm.walk.speed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.walk.uphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.walk.downhill=t.getWalkDownhill())),e.sources.push(n)}),e},getTravelTimePolygons:function(t,e,i,n){t.getWaitControl()&&(t.getWaitControl().show(),t.getWaitControl().updateText(a.config.i18n.getSpan("polygonWait")));var o=a.PolygonService.getCfg(t);if(a.has(a.PolygonService.cache,JSON.stringify(o)))t.getWaitControl()&&t.getWaitControl().hide(),e(a.Util.parsePolygons(a.PolygonService.cache[JSON.stringify(o)]));else{var r=a.PolygonService.getAjaxOptions(t,o,e,i,"undefined"==typeof n?"GET":n);$.ajax(r)}},getAjaxOptions:function(t,e,i,n,o){var r="undefined"!=typeof t.getServiceUrl()?t.getServiceUrl():a.config.serviceUrl,s={url:r+a.config.serviceVersion+"/polygon?cfg="+encodeURIComponent(JSON.stringify(e))+"&cb=?&key="+t.getServiceKey(),timeout:a.config.requestTimeout,dataType:"json",type:o,success:function(o){t.getWaitControl()&&t.getWaitControl().hide(),a.has(o,"data")?"ok"==o.code?(a.PolygonService.cache[JSON.stringify(e)]=o.data,i(a.Util.parsePolygons(o.data))):a.isFunction(n)&&n(o.code,o.message):(a.PolygonService.cache[JSON.stringify(e)]=o,i(a.Util.parsePolygons(o)))},error:function(e){t.getWaitControl()&&t.getWaitControl().hide(),a.isFunction(n)&&(403==e.status?n("not-authorized",e.responseText):n("service-not-available","The travel time polygon service is currently not available, please try again later."))}};return"POST"==o&&(s.url=r+a.config.serviceVersion+"/polygon_post?key="+t.getServiceKey(),s.data=JSON.stringify(e),s.contentType="application/json",s.async=!1),s}},a.PopulationService={cache:{},getPopulationStatistics:function(t,e,i,n){t.getWaitControl()&&(t.getWaitControl().show(),t.getWaitControl().updateText(a.config.i18n.getSpan("populationWait")));var o={};o.sources=[],"undefined"!=typeof t.isElevationEnabled()&&(o.elevation=t.isElevationEnabled()),("undefined"!=typeof t.getTravelTimes()||"undefined"!=typeof t.getIntersectionMode()||"undefined"!=typeof t.getRenderWatts()||"undefined"!=typeof t.getSupportWatts())&&(o.polygon={},"undefined"!=typeof t.getTravelTimes()&&(o.polygon.values=t.getTravelTimes()),"undefined"!=typeof t.getIntersectionMode()&&(o.polygon.intersectionMode=t.getIntersectionMode()),"undefined"!=typeof t.getRenderWatts()&&(o.polygon.renderWatts=t.getRenderWatts()),"undefined"!=typeof t.getSupportWatts()&&(o.polygon.supportWatts=t.getSupportWatts())),t.getSources().forEach(function(e){var i={lat:a.has(e,"lat")?e.lat:e.getLatLng().lat,lng:a.has(e,"lon")?e.lon:a.has(e,"lng")?e.lng:e.getLatLng().lng,id:a.has(e,"id")?e.id:e.lat+";"+e.lng,tm:{}},n=a.has(e,"travelType")?e.travelType:t.getTravelType();i.tm[n]={},"transit"==n&&(i.tm.transit.frame={},a.isUndefined(t.getTime())||(i.tm.transit.frame.time=t.getTime()),a.isUndefined(t.getDate())||(i.tm.transit.frame.date=t.getDate())),"ebike"==n&&(i.tm.ebike={},a.isUndefined(t.getBikeSpeed())||(i.tm.ebike.speed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(i.tm.ebike.uphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(i.tm.ebike.downhill=t.getBikeDownhill())),"rentbike"==n&&(i.tm.rentbike={},a.isUndefined(t.getBikeSpeed())||(i.tm.rentbike.bikespeed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(i.tm.rentbike.bikeuphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(i.tm.rentbike.bikedownhill=t.getBikeDownhill()),a.isUndefined(t.getWalkSpeed())||(i.tm.rentbike.walkspeed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(i.tm.rentbike.walkuphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(i.tm.rentbike.walkdownhill=t.getWalkDownhill())),"rentandreturnbike"==n&&(i.tm.rentandreturnbike={},a.isUndefined(t.getBikeSpeed())||(i.tm.rentandreturnbike.bikespeed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(i.tm.rentandreturnbike.bikeuphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(i.tm.rentandreturnbike.bikedownhill=t.getBikeDownhill()),a.isUndefined(t.getWalkSpeed())||(i.tm.rentandreturnbike.walkspeed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(i.tm.rentandreturnbike.walkuphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(i.tm.rentandreturnbike.walkdownhill=t.getWalkDownhill())),"bike"==n&&(i.tm.bike={},a.isUndefined(t.getBikeSpeed())||(i.tm.bike.speed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(i.tm.bike.uphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(i.tm.bike.downhill=t.getBikeDownhill())),"walk"==n&&(i.tm.walk={},a.isUndefined(t.getWalkSpeed())||(i.tm.walk.speed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(i.tm.walk.uphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(i.tm.walk.downhill=t.getWalkDownhill())),o.sources.push(i)});var r=[];a.each(e,function(t){r.push("statistics="+t)}),a.has(a.PopulationService.cache,JSON.stringify(o)+r.join("&"))?(t.getWaitControl()&&t.getWaitControl().hide(),i(a.PopulationService.cache[JSON.stringify(o)+r.join("&")])):$.ajax({url:t.getServiceUrl()+a.config.serviceVersion+"/population?cfg="+encodeURIComponent(JSON.stringify(o))+"&cb=?&key="+t.getServiceKey()+"&"+r.join("&"),timeout:a.config.requestTimeout,dataType:"json",success:function(e){t.getWaitControl()&&t.getWaitControl().hide(),a.has(e,"data")?"ok"==e.code?(a.PopulationService.cache[JSON.stringify(o)+r.join("&")]=e.data,i(e.data)):a.isFunction(n)&&n(e.code,e.message):(a.PopulationService.cache[JSON.stringify(o)+r.join("&")]=e,i(e))},error:function(e){t.getWaitControl()&&t.getWaitControl().hide(),a.isFunction(n)&&n("service-not-available","The population service is currently not available, please try again later.")}})}},a.RouteService={cache:{},getCfg:function(t){var e={sources:[],targets:[],pathSerializer:t.getPathSerializer(),elevation:t.isElevationEnabled()};return t.getSources().forEach(function(i){var n={lat:a.has(i,"lat")?i.lat:i.getLatLng().lat,lng:a.has(i,"lon")?i.lon:a.has(i,"lng")?i.lng:i.getLatLng().lng,id:a.has(i,"id")?i.id:"",tm:{}},o=a.has(i,"travelType")?i.travelType:t.getTravelType();n.tm[o]={},("transit"==o||"biketransit"==o)&&(n.tm[o].frame={},a.isUndefined(t.getTime())||(n.tm[o].frame.time=t.getTime()),a.isUndefined(t.getDate())||(n.tm[o].frame.date=t.getDate()),a.isUndefined(t.getRecommendations())||(n.tm[o].recommendations=t.getRecommendations())),"ebike"==o&&(n.tm.ebike={},a.isUndefined(t.getBikeSpeed())||(n.tm.ebike.speed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.ebike.uphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.ebike.downhill=t.getBikeDownhill())),"rentbike"==o&&(n.tm.rentbike={},a.isUndefined(t.getBikeSpeed())||(n.tm.rentbike.bikespeed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.rentbike.bikeuphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.rentbike.bikedownhill=t.getBikeDownhill()),a.isUndefined(t.getWalkSpeed())||(n.tm.rentbike.walkspeed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.rentbike.walkuphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.rentbike.walkdownhill=t.getWalkDownhill())),"rentandreturnbike"==o&&(n.tm.rentandreturnbike={},a.isUndefined(t.getBikeSpeed())||(n.tm.rentandreturnbike.bikespeed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.rentandreturnbike.bikeuphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.rentandreturnbike.bikedownhill=t.getBikeDownhill()),a.isUndefined(t.getWalkSpeed())||(n.tm.rentandreturnbike.walkspeed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.rentandreturnbike.walkuphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.rentandreturnbike.walkdownhill=t.getWalkDownhill())),"bike"==o&&(n.tm.bike={},a.isUndefined(t.getBikeSpeed())||(n.tm.bike.speed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.bike.uphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.bike.downhill=t.getBikeDownhill())),"walk"==o&&(n.tm.walk={},a.isUndefined(t.getWalkSpeed())||(n.tm.walk.speed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.walk.uphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.walk.downhill=t.getWalkDownhill())),e.sources.push(n)}),e.targets=[],t.getTargets().forEach(function(t){e.targets.push({lat:a.has(t,"lat")?t.lat:t.getLatLng().lat,lng:a.has(t,"lon")?t.lon:a.has(t,"lng")?t.lng:t.getLatLng().lng,id:a.has(t,"id")?t.id:""})}),e},getRoutes:function(t,e,i){t.getWaitControl()&&(t.getWaitControl().show(),t.getWaitControl().updateText(a.config.i18n.getSpan("routeWait")));var n=a.RouteService.getCfg(t);a.has(a.RouteService.cache,JSON.stringify(n))?(t.getWaitControl()&&t.getWaitControl().hide(),e(a.Util.parseRoutes(JSON.parse(JSON.stringify(a.RouteService.cache[JSON.stringify(n)]))))):$.ajax({url:t.getServiceUrl()+a.config.serviceVersion+"/route?cfg="+encodeURIComponent(JSON.stringify(n))+"&cb=?&key="+t.getServiceKey(),timeout:a.config.requestTimeout,dataType:"json",success:function(o){t.getWaitControl()&&t.getWaitControl().hide(),a.has(o,"data")?"ok"==o.code?(a.RouteService.cache[JSON.stringify(n)]=JSON.parse(JSON.stringify(o.data)),e(a.Util.parseRoutes(o.data))):a.isFunction(i)&&i(o.code,o.message):(a.RouteService.cache[JSON.stringify(n)]=JSON.parse(JSON.stringify(o)),e(a.Util.parseRoutes(o)))},error:function(e){t.getWaitControl()&&t.getWaitControl().hide(),a.isFunction(i)&&(403==e.status?i("not-authorized",e.responseText):i("service-not-available","The routing service is currently not available, please try again later."))}})}},a.TimeService={cache:{},getCfg:function(t){var e={sources:[],targets:[],pathSerializer:t.getPathSerializer(),maxRoutingTime:t.getMaxRoutingTime()};return a.isUndefined(t.isElevationEnabled())||(e.elevation=t.isElevationEnabled()),a.isUndefined(t.getTravelTimes())&&a.isUndefined(t.getIntersectionMode())&&a.isUndefined(t.getRenderWatts())&&a.isUndefined(t.getSupportWatts())||(e.polygon={},a.isUndefined(t.getTravelTimes())||(e.polygon.values=t.getTravelTimes()),a.isUndefined(t.getIntersectionMode())||(e.polygon.intersectionMode=t.getIntersectionMode()),a.isUndefined(t.getRenderWatts())||(e.polygon.renderWatts=t.getRenderWatts()),a.isUndefined(t.getSupportWatts())||(e.polygon.supportWatts=t.getSupportWatts()),a.isUndefined(t.getMinPolygonHoleSize())||(e.polygon.minPolygonHoleSize=t.getMinPolygonHoleSize())),t.getSources().forEach(function(i){var n={lat:a.has(i,"lat")?i.lat:i.getLatLng().lat,lng:a.has(i,"lon")?i.lon:a.has(i,"lng")?i.lng:i.getLatLng().lng,id:a.has(i,"id")?i.id:"",tm:{}};""==n.id&&(n.id=n.lat+";"+n.lng);var o=a.has(i,"travelType")?i.travelType:t.getTravelType();n.tm[o]={},("transit"==o||"biketransit"==o)&&(n.tm[o].frame={},a.isUndefined(t.getTime())||(n.tm[o].frame.time=t.getTime()),a.isUndefined(t.getDate())||(n.tm[o].frame.date=t.getDate())),"ebike"==o&&(n.tm.ebike={},a.isUndefined(t.getBikeSpeed())||(n.tm.ebike.speed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.ebike.uphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.ebike.downhill=t.getBikeDownhill())),"rentbike"==o&&(n.tm.rentbike={},a.isUndefined(t.getBikeSpeed())||(n.tm.rentbike.bikespeed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.rentbike.bikeuphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.rentbike.bikedownhill=t.getBikeDownhill()),a.isUndefined(t.getWalkSpeed())||(n.tm.rentbike.walkspeed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.rentbike.walkuphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.rentbike.walkdownhill=t.getWalkDownhill())),"rentandreturnbike"==o&&(n.tm.rentandreturnbike={},a.isUndefined(t.getBikeSpeed())||(n.tm.rentandreturnbike.bikespeed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.rentandreturnbike.bikeuphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.rentandreturnbike.bikedownhill=t.getBikeDownhill()),a.isUndefined(t.getWalkSpeed())||(n.tm.rentandreturnbike.walkspeed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.rentandreturnbike.walkuphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.rentandreturnbike.walkdownhill=t.getWalkDownhill())),"bike"==o&&(n.tm.bike={},a.isUndefined(t.getBikeSpeed())||(n.tm.bike.speed=t.getBikeSpeed()),a.isUndefined(t.getBikeUphill())||(n.tm.bike.uphill=t.getBikeUphill()),a.isUndefined(t.getBikeDownhill())||(n.tm.bike.downhill=t.getBikeDownhill())),"walk"==o&&(n.tm.walk={},a.isUndefined(t.getWalkSpeed())||(n.tm.walk.speed=t.getWalkSpeed()),a.isUndefined(t.getWalkUphill())||(n.tm.walk.uphill=t.getWalkUphill()),a.isUndefined(t.getWalkDownhill())||(n.tm.walk.downhill=t.getWalkDownhill())),e.sources.push(n)}),t.getTargets().forEach(function(t){var t={lat:a.has(t,"lat")?t.lat:t.getLatLng().lat,lng:a.has(t,"lon")?t.lon:a.has(t,"lng")?t.lng:t.getLatLng().lng,id:a.has(t,"id")?t.id:""};""==t.id&&(t.id=t.lat+";"+t.lng),e.targets.push(t)}),e},getRouteTime:function(t,e,i){t.getWaitControl()&&(t.getWaitControl().show(),t.getWaitControl().updateText(a.config.i18n.getSpan("timeWait")));var n=a.TimeService.getCfg(t);a.has(a.TimeService.cache,JSON.stringify(n))?(t.getWaitControl()&&t.getWaitControl().hide(),e(a.TimeService.cache[JSON.stringify(n)])):$.ajax({url:t.getServiceUrl()+a.config.serviceVersion+"/time?key="+t.getServiceKey(),type:"POST",data:JSON.stringify(n),contentType:"application/json",timeout:a.config.requestTimeout,dataType:"json",success:function(o){t.getWaitControl()&&t.getWaitControl().hide(),a.has(o,"data")?"ok"==o.code?(a.TimeService.cache[JSON.stringify(n)]=o.data,e(o.data)):a.isFunction(i)&&i(o.code,o.message):(a.TimeService.cache[JSON.stringify(n)]=o,e(o))},error:function(e){t.getWaitControl()&&t.getWaitControl().hide(),a.isFunction(i)&&(403==e.status?i("not-authorized",e.responseText):i("service-not-available","The time service is currently not available, please try again later."))}})}},a.OsmService={cache:{},getPoisInBoundingBox:function(t,e,i,n,o){i&&(i.show(),i.updateText(a.config.i18n.getSpan("osmWait")));var r=$.param({tags:e},!0);"undefined"!=typeof t&&(r.northEast=t._northEast.lng+"|"+t._northEast.lat,r.southWest=t._southWest.lng+"|"+t._southWest.lat),a.has(a.OsmService.cache,r)?(i&&i.hide(),n(a.OsmService.cache[r])):$.ajax({url:a.config.osmServiceUrl+"pois/search?callback=?&"+r,timeout:a.config.requestTimeout,dataType:"json",success:function(t){i&&i.hide(),n(t)},error:function(t){i&&i.hide(),a.isFunction(o)&&o("service-not-available","The travel time polygon service is currently not available, please try again later.")}})}},a.Projection={},a.Projection.SphericalMercator={R:6378137,project:function(t){var e=Math.PI/180,i=1-1e-15,n=Math.max(Math.min(Math.sin(t.lat*e),i),-i);return new a.Point(this.R*t.lng*e,this.R*Math.log((1+n)/(1-n))/2)},unproject:function(t){var e=180/Math.PI;return new a.LatLng((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=6378137*Math.PI;return a.bounds([-t,-t],[t,t])}()},a.Transformation=function(t,e,i,n){this._a=t,this._b=e,this._c=i,this._d=n},a.Transformation.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new a.Point((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}},a.CRS={latLngToPoint:function(t,e){var i=this.projection.project(t),n=this.scale(e);return this.transformation._transform(i,n)},pointToLatLng:function(t,e){var i=this.scale(e),n=this.transformation.untransform(t,i);return this.projection.unproject(n)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,i=this.scale(t),n=this.transformation.transform(e.min,i),o=this.transformation.transform(e.max,i);return a.bounds(n,o)},wrapLatLng:function(t){var e=this.wrapLng?a.Util.wrapNum(t.lng,this.wrapLng,!0):t.lng,i=this.wrapLat?a.Util.wrapNum(t.lat,this.wrapLat,!0):t.lat,n=t.alt;return a.latLng(i,e,n)}},a.CRS.Earth=a.extend({},a.CRS,{wrapLng:[-180,180],R:6378137,distance:function(t,e){var i=Math.PI/180,n=t.lat*i,o=e.lat*i,r=Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos((e.lng-t.lng)*i);return this.R*Math.acos(Math.min(r,1))}}),a.CRS.EPSG3857=a.extend({},a.CRS.Earth,{code:"EPSG:3857",projection:a.Projection.SphericalMercator,transformation:function(){var t=.5/Math.PI;return new a.Transformation(t,.5,-t,.5)}()}),a.CRS.EPSG900913=a.extend({},a.CRS.EPSG3857,{code:"EPSG:900913"}),a.polygon=function(t,e,i){return new a.Polygon(t,e,i)},a.Polygon=function(t,e,i){this.travelTime=t,this.area=e,this.color="black",this.opacity=.5,this.lineStrings=[i],this.bounds=n,this.setTravelTime=function(t){this.travelTime=t},this.getTravelTime=function(){return this.travelTime},this.getColor=function(){return this.color},this.setColor=function(t){this.color=t},this.setOpacity=function(t){this.opacity=t},this.getOpacity=function(){return this.opacity},this.getArea=function(){return this.area},this.setArea=function(t){this.area=t},this.getOuterBoundary=function(){return this.lineStrings[0]},this.getInnerBoundary=function(){return this.lineStrings.slice(1)},this.getTopRight4326=function(){return this.getOuterBoundary().getTopRight4326()},this.getTopRight3857=function(){return this.getOuterBoundary().getTopRight3857()},this.getTopRightDecimal=function(){return this.getOuterBoundary().getTopRightDecimal()},this.getBottomLeft4326=function(){return this.getOuterBoundary().getBottomLeft4326()},this.getBottomLeft3857=function(){return this.getOuterBoundary().getBottomLeft3857()},this.getBottomLeftDecimal=function(){return this.getOuterBoundary().getBottomLeftDecimal()},this.addInnerBoundary=function(t){this.lineStrings.push(t)}},a.MultiPolygon=function(){this.travelTime,this.color,this.polygons=new Array,this.topRight_3857=new a.Point(-20026377,-20048967),this.bottomLeft_3857=new a.Point(20026377,20048967),this.addPolygon=function(t){this.polygons.push(t),t.getOuterBoundary().getTopRight3857().x>this.topRight_3857.x&&(this.topRight_3857.x=t.getOuterBoundary().getTopRight3857().x),t.getOuterBoundary().getTopRight3857().y>this.topRight_3857.y&&(this.topRight_3857.y=t.getOuterBoundary().getTopRight3857().y),t.getOuterBoundary().getBottomLeft3857().x<this.bottomLeft_3857.x&&(this.bottomLeft_3857.x=t.getOuterBoundary().getBottomLeft3857().x),t.getOuterBoundary().getBottomLeft3857().y<this.bottomLeft_3857.y&&(this.bottomLeft_3857.y=t.getOuterBoundary().getBottomLeft3857().y)},this.getBoundingBox3857=function(){return a.bounds(this.bottomLeft_3857,this.topRight_3857)},this.getBoundingBox4326=function(){return a.latLngBounds(a.Util.webMercatorToLatLng(this.bottomLeft_3857),a.Util.webMercatorToLatLng(this.topRight_3857))},this.setOpacity=function(t){this.opacity=t},this.getOpacity=function(){return this.opacity},this.getArea=function(){var t=0;return this.polygons.forEach(function(e){t+=e.getArea()}),t},this.getPolygons=function(){return this.polygons},this.setColor=function(t){this.color=t},this.getColor=function(){return this.color},this.getTravelTime=function(){return this.travelTime},this.setTravelTime=function(t){this.travelTime=t}},a.multiPolygon=function(){return new a.MultiPolygon},a.lineString=function(t){return new a.LineString(t)},a.LineString=function(t){this.topRight_3857=new a.Point(-20026377,-20048967),this.bottomLeft_3857=new a.Point(20026377,20048967),this.coordinates=[];for(var e=t.length-1;e>=0;e--)t[e].x>this.topRight_3857.x&&(this.topRight_3857.x=t[e].x),t[e].y>this.topRight_3857.y&&(this.topRight_3857.y=t[e].y),t[e].x<this.bottomLeft_3857.x&&(this.bottomLeft_3857.x=t[e].x),t[e].y<this.bottomLeft_3857.y&&(this.bottomLeft_3857.y=t[e].y);for(var e=0;e<t.length;e++)this.coordinates.push(a.Util.webMercatorToLeaflet(t[e]));this.getTopRight4326=function(){return a.Util.webMercatorToLatLng(new a.Point(this.topRight_3857.x,this.topRight_3857.y))},this.getTopRight3857=function(){return this.topRight_3857},this.getTopRightDecimal=function(){return a.Util.webMercatorToLeaflet(this.topRight_3857)},this.getBottomLeft4326=function(){return a.Util.webMercatorToLatLng(new a.Point(this.bottomLeft_3857.x,this.bottomLeft_3857.y))},this.getBottomLeft3857=function(){return this.bottomLeft_3857},this.getBottomLeftDecimal=function(){return a.Util.webMercatorToLeaflet(this.bottomLeft_3857)},this.getCoordinates=function(){return this.coordinates},this.getCoordinate=function(t){return this.coordinate[t]}},a.RouteSegment=function(t){var e=this;if(e.points=[],e.type=t.type,e.travelTime=t.travelTime,e.distance=t.length/1e3,e.warning=t.warning,e.elevationGain=t.elevationGain,e.errorMessage,e.transitSegment=!1,e.startname=t.startname,e.endname=t.endname,t.points.forEach(function(t){e.points.push(a.Util.webMercatorToLatLng(new a.Point(t[1],t[0]),t[2]))}),t.isTransit){var i=a.findWhere(a.config.routeTypes,{routeType:t.routeType});e.color="undefined"!=typeof i&&a.has(i,"color")?i.color:"RED",e.haloColor="undefined"!=typeof i&&a.has(i,"haloColor")?i.haloColor:"WHITE",e.transitSegment=!0,e.routeType=t.routeType,e.routeShortName=t.routeShortName,e.startname=t.startname,e.endname=t.endname,e.departureTime=t.departureTime,e.arrivalTime=t.arrivalTime,e.tripHeadSign=t.tripHeadSign}else{var i=a.findWhere(a.config.routeTypes,{routeType:t.type});e.color="undefined"!=typeof i&&a.has(i,"color")?i.color:"RED",e.haloColor="undefined"!=typeof i&&a.has(i,"haloColor")?i.haloColor:"WHITE"}e.getPoints=function(){return e.points},e.getType=function(){return e.type},e.getHaloColor=function(){return e.haloColor},e.getColor=function(){return e.color},e.getTravelTime=function(){return e.travelTime},e.getDistance=function(){return e.distance},e.getRouteType=function(){return e.routeType},e.getRouteShortName=function(){return e.routeShortName},e.getStartName=function(){return e.startname},e.getEndName=function(){return e.endname},e.getDepartureTime=function(){return e.departureTime},e.getArrivalTime=function(){return e.arrivalTime},e.getTripHeadSign=function(){return e.tripHeadSign},e.getWarning=function(){return e.warning},e.getElevationGain=function(){return e.elevationGain},e.isTransit=function(){return e.transitSegment}},a.routeSegment=function(t){return new a.RouteSegment(t)},a.Route=function(t,e){var i=this;i.travelTime=t,i.routeSegments=[],i.points=[],i.uphillMeter=0,i.downhillMeter=0,i.targetHeight=n,i.sourceHeight=n,e.reverse().forEach(function(t){var e=a.routeSegment(t);i.routeSegments.push(e),i.points=i.points.concat(e.getPoints().reverse())}),i.equals=function(t){return i.getKey()===t.getKey()},i.getKey=function(){var e=t,n="";return i.getSegments().forEach(function(t){e+=" "+t.getRouteShortName()+" "+t.getDepartureTime()+" "+t.getArrivalTime(),t.getPoints().forEach(function(t){n+=" "+t.lat+t.lng})}),e+n},i.addRouteSegment=function(t){i.routeSegments.push(t)},i.setTravelTime=function(t){i.travelTime=t},i.getDistance=function(){for(var t=0,e=0;e<i.routeSegments.length;e++)t+=i.routeSegments[e].getDistance();return t},i.getElevationGain=function(){for(var t=0,e=0;e<i.routeSegments.length;e++)t+=i.routeSegments[e].getElevationGain();return t},i.getElevations=function(){for(var t={x:[],y:[]},e=0;e<1e3*i.getDistance();e+=100)t.x.push(e/1e3+" km"),t.y.push(i.getElevationAt(e));return t},i.getElevationAt=function(t){for(var e=0,n=1;n<i.points.length;n++){var o=i.points[n-1],r=i.points[n],a=o.distanceTo(r);if(e+=a,e>t)return r.alt}},i.getSegments=function(){return i.routeSegments},i.getUphillElevation=function(){return i.uphillMeter},i.getDownhillElevation=function(){return i.downhillMeter},i.getTotalElevationDifference=function(){return Math.abs(i.sourceHeight-i.targetHeight)},i.setElevationDifferences=function(){for(var t=n,e=i.points.length-1;e>=0;e--)0==e&&(i.targetHeight=i.points[e].alt),e==i.points.length-1&&(i.sourceHeight=i.points[e].alt),"undefined"!=typeof t&&(t>i.points[e].alt?i.uphillMeter+=t-i.points[e].alt:t<i.points[e].alt&&(i.downhillMeter+=i.points[e].alt-t)),t=i.points[e].alt;
}(),i.getTravelTime=function(){return i.travelTime}},a.route=function(t,e){return new a.Route(t,e)},a.LeafletPolygonLayer=L.Class.extend({initialize:function(t){this.opacity=a.config.defaultPolygonLayerOptions.opacity,this.strokeWidth=a.config.defaultPolygonLayerOptions.strokeWidth,this.tolerance=a.config.defaultPolygonLayerOptions.tolerance,this.extendWidthX=a.config.defaultPolygonLayerOptions.strokeWidth/2,this.extendWidthY=a.config.defaultPolygonLayerOptions.strokeWidth/2,this.backgroundColor=a.config.defaultPolygonLayerOptions.backgroundColor,this.backgroundOpacity=a.config.defaultPolygonLayerOptions.backgroundOpacity,this.colors=a.config.defaultPolygonLayerOptions.travelTimes,"undefined"!=typeof t&&("undefined"!=typeof t.colors&&(this.colors=t.colors),"undefined"!=typeof t.opacity&&(this.opacity=t.opacity),"undefined"!=typeof t.strokeWidth&&(this.strokeWidth=t.strokeWidth),"undefined"!=typeof t.inverse&&(this.inverse=t.inverse),"undefined"!=typeof t.tolerance&&(this.tolerance=t.tolerance),"undefined"!=typeof t.extendWidthX&&(this.extendWidthX=t.extendWidthX),"undefined"!=typeof t.extendWidthY&&(this.extendWidthY=t.extendWidthY))},setInverse:function(t){this.inverse=t},getInverse:function(){return this.inverse},getBoundingBox3857:function(){return this.multiPolygons[0].getBoundingBox3857()},getBoundingBox4326:function(){return this.multiPolygons[0].getBoundingBox4326()},onAdd:function(t){this.map=t,this.id=a.Util.generateId(),this.element=L.DomUtil.create("div","r360-leaflet-polygon-layer-"+$(t._container).attr("id")+"-"+this.id+" leaflet-zoom-hide"),$(this.element).attr("id","canvas"+$(this.map._container).attr("id")+"-"+this.id),this.map.getPanes().overlayPane.appendChild(this.element),this.map.on("moveend",this.draw,this),this.draw()},fitMap:function(t){var e=this.getBoundingBox4326(),i=e.getSouthWest(),n=e.getNorthEast();this.map.fitBounds(L.latLngBounds(L.latLng({lat:i.lat,lng:i.lng}),L.latLng({lat:n.lat,lng:n.lng})),t)},clearAndAddLayers:function(t,e,i){return this.clearLayers(),this.addLayer(t),"undefined"!=typeof e&&e===!0&&this.fitMap(i),this},addLayer:function(t){this.multiPolygons=t,this.draw()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t.getPanes().overlayPane.removeChild(this.element),t.off("viewreset",this.draw,this)},createSvgData:function(t){var e=a.PolygonUtil.extendBounds(this.getMapPixelBounds(),this.extendWidthX,this.extendWidthY);return a.SvgUtil.createSvgData(t,{bounds:e,scale:256*Math.pow(2,this.map._zoom),tolerance:this.tolerance,pixelOrigin:this.map.getPixelOrigin(),offset:this.offset})},getMapPixelBounds:function(){var t=this.map.getPixelBounds();return{max:{x:t.max.x,y:t.max.y},min:{x:t.min.x,y:t.min.y}}},clearLayers:function(){this.multiPolygons=n,$("#canvas"+$(this.map._container).attr("id")+"-"+this.id).empty()},setStrokeWidth:function(t){this.strokeWidth=t},setColors:function(t){if("undefined"!=typeof this.multiPolygons){this.colors=t;for(var e=0;e<this.multiPolygons.length;e++){var i=this.multiPolygons[e];this.colors.forEach(function(t){t.time==i.getTravelTime()&&i.setColor(t.color)})}this.draw()}},draw:function(){if("undefined"!=typeof this.multiPolygons){this.extendWidthX=1.8*this.map.getSize().x-this.map.getSize().x,this.extendWidthY=1.8*this.map.getSize().y-this.map.getSize().y,this.svgWidth=this.map.getSize().x+this.extendWidthX,this.svgHeight=this.map.getSize().y+this.extendWidthY;var t=$("#svg_"+$(this.map._container).attr("id")+"-"+this.id).offset(),e=$(this.map._container).offset();"undefined"==typeof this.offset&&(this.offset={x:0,y:0}),t&&(this.offset.x+=e.left-t.left-this.extendWidthX/2,this.offset.y+=e.top-t.top-this.extendWidthY/2),$("#canvas"+$(this.map._container).attr("id")+"-"+this.id).empty();for(var i=[],n=0;n<this.multiPolygons.length;n++){for(var o=this.multiPolygons[n],r=[],s=0;s<o.polygons.length;s++)r.push(this.createSvgData(o.polygons[s]));0!=r.length&&i.push(a.SvgUtil.getGElement(r,{color:this.inverse?"black":o.getColor(),opacity:this.inverse?o.getOpacity():1,strokeWidth:this.strokeWidth}))}var l={id:$(this.map._container).attr("id")+"-"+this.id,offset:this.offset,svgHeight:this.svgHeight,svgWidth:this.svgWidth,backgroundColor:this.backgroundColor,backgroundOpacity:this.backgroundOpacity,opacity:this.opacity,strokeWidth:this.strokeWidth};$("#canvas"+$(this.map._container).attr("id")+"-"+this.id).append(this.inverse?a.SvgUtil.getInverseSvgElement(i,l):a.SvgUtil.getNormalSvgElement(i,l))}}}),a.leafletPolygonLayer=function(t){return new a.LeafletPolygonLayer(t)},CanvasLayer=L.Class.extend({initialize:function(t){"use strict";this.items=new Array;var e=this;e.mapZoomPowerLookup=new Array;for(var i=0;25>i;i++)e.mapZoomPowerLookup[i]=256*Math.pow(2,i)},getItemBelowCursor:function(t,e){var n=this;for(i=0;i<t.length;i++)if(n.containedByCanvas(t[i].currentPixel)&&n.containedByIcon(t[i],e))return t[i];return null},containedByCanvas:function(t){return t.x>=0&&t.x<=this.canvasWidth&&t.y>=0&&t.y<=this.canvasHeight?!0:!1},containedByIcon:function(t,e){var i=e.pageX-this.mapPosition.left,n=e.pageY-this.mapPosition.top,o=i-t.currentPixel.x,r=n-t.currentPixel.y,a=this.getRingSizesByZoom(t.icon,this.map._zoom);return o>-a.outerRing&&r>-a.outerRing&&o<a.outerRing+12&&r<a.outerRing+12?!0:!1},getBoundingBox3857:function(){},getBoundingBox4326:function(){},onAdd:function(t){var e=this;e.map=t,e.id=$(e.map._container).attr("id")+"_"+a.Util.generateId(),e.elementId="r360-leaflet-canvas-poi-layer-"+e.id+" leaflet-zoom-hide",e.poiCanvasId="poi-canvas"+e.id,e.poiMarkerClickId="poi_marker_click_"+e.id,e.poiMarkerHoverId="poi_marker_hover_"+e.id,e.markerMainCanvasId="canvas_"+e.id,e.element=L.DomUtil.create("div",e.elementId),$(e.element).attr("id",e.poiCanvasId),e.map.getPanes().overlayPane.appendChild(e.element),e.map.on("moveend",e.redraw,e),$("#"+$(e.map._container).attr("id")).on("mousemove",function(t){e.clearMarkerHover(),$("#"+e.poiCanvasId).attr("style","cursor: move; cursor: grab; cursor:-moz-grab; cursor:-webkit-grab;");var i=e.getItemBelowCursor(e.items,t);null!=i&&(i.onHover(),$("#"+e.poiCanvasId).css("cursor","pointer"),e.drawMarkerHover(i))}),$("#"+$(e.map._container).attr("id")).on("click",function(t){e.clearMarkerHover();var i=e.getItemBelowCursor(e.items,t);null!=i&&(i.onClick(),e.drawMarkerClick(i))}),e.resetCanvas()},fitMap:function(t){var e=this.getBoundingBox4326(),i=e.getSouthWest(),n=e.getNorthEast();this.map.fitBounds(L.latLngBounds(L.latLng({lat:i.lat,lng:i.lng}),L.latLng({lat:n.lat,lng:n.lng})),t)},clearAndAddLayers:function(t,e,i){return this.clearLayers(),this},addItem:function(t){this.items.push(t),t.coordinate=a.Util.webMercatorToLeaflet(t.point),this.draw(t)},addLatLngItem:function(t){var e=a.Util.latLngToWebMercator(t.point);return e.x/=6378137,e.y/=6378137,this.items.push(t),t.coordinate=a.Util.webMercatorToLeaflet(e),this.draw(t),t},addLayer:function(t){this.poiSet=t;this.draw()},addTo:function(t){return t.addLayer(this),this},onRemove:function(t){t.getPanes().overlayPane.removeChild(this.element),t.off("viewreset",this.draw,this)},getMapPixelBounds:function(){var t=this.map.getPixelBounds();return{max:{x:t.max.x,y:t.max.y},min:{x:t.min.x,y:t.min.y}}},clearLayers:function(){this.multiPolygons=n,$("#poi-canvas"+$(this.map._container).attr("id")).empty()},getRingSizesByZoom:function(t,e){var i={};return t.sizes.forEach(function(t){e<=t.toZoom&&e>=t.fromZoom&&(i.outerRing=t.outerRing,i.innerRing=t.innerRing)}),i},drawRingIcon:function(t,e,i){var n=this.getRingSizesByZoom(e,this.map._zoom);t.beginPath(),t.arc(i.x,i.y,n.outerRing,0,2*Math.PI,!1),t.fillStyle=e.strokeStyle,t.fill(),t.beginPath(),t.arc(i.x,i.y,n.innerRing,0,2*Math.PI,!1),t.fillStyle=e.fillStyle,t.fill()},drawMarkerHover:function(t){var i=e.getElementById("#"+this.poiMarkerHoverId),n=i.getContext("2d");n.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.drawRingIcon(n,t.hoverIcon,t.currentPixel)},drawMarkerClick:function(t){var i=e.getElementById("#"+this.poiMarkerClickId),n=i.getContext("2d");n.clearRect(0,0,this.canvasWidth,this.canvasHeight),this.drawRingIcon(n,t.clickIcon,t.currentPixel)},clearMarkerHover:function(){var t=e.getElementById("#"+this.poiMarkerHoverId),i=t.getContext("2d");i.clearRect(0,0,this.canvasWidth,this.canvasHeight)},clearMarkerClick:function(){var t=e.getElementById("#"+this.poiMarkerClickId),i=t.getContext("2d");i.clearRect(0,0,this.canvasWidth,this.canvasHeight)},getCanvas:function(t,e,i,n){var o='<canvas id="#'+n+'" width="'+t+'" height="'+e+'" style="position:absolute; top:0px; left:0px; z-index: '+i+';"></canvas>';return o},draw:function(t){var e=a.PolygonUtil.scale(t.coordinate,this.mapZoomPowerLookup[this.map._zoom]),i={x:parseInt(e.x-this.origin.x-this.offset.x),y:parseInt(e.y-this.origin.y-this.offset.y)};t.currentPixel=i,this.containedByCanvas(i)&&1!=this.arr[i.x+";"+i.y]&&(this.drawRingIcon(this.mainMarcerCanvasCtx,t.icon,i),this.arr[i.x+";"+i.y]=!0)},updateOffset:function(){var t=$("#canvas_div_"+this.id).offset();this.mapPosition=$(this.map._container).offset(),"undefined"==typeof this.offset&&(this.offset={x:0,y:0}),t&&(this.offset.x+=this.mapPosition.left-t.left,this.offset.y+=this.mapPosition.top-t.top)},resetCanvas:function(){var t=this;this.canvasWidth=this.map.getSize().x,this.canvasHeight=this.map.getSize().y,this.updateOffset(),$("#"+this.poiCanvasId).empty();var i=a.Util.getTranslation(this.offset),n=this.getCanvas(this.canvasWidth,this.canvasHeight,20,this.poiMarkerClickId),o=this.getCanvas(this.canvasWidth,this.canvasHeight,10,this.poiMarkerHoverId),r=this.getCanvas(this.canvasWidth,this.canvasHeight,0,this.markerMainCanvasId),s="canvas_div_"+t.id;$("#"+this.poiCanvasId).append("<div id="+s+' style="'+i+'">'+n+o+r+"</div>"),this.updateOffset(),c=e.getElementById("#"+this.markerMainCanvasId),this.mainMarcerCanvasCtx=c.getContext("2d"),this.arr=new Array,this.origin=this.map.getPixelOrigin()},redraw:function(){that=this,that.resetCanvas(),that.items.forEach(function(t){that.draw(t)})}}),a.LeafletUtil={getMarker:function(t,e){var i=a.has(e,"color")?"-"+e.color:"-blue";return e.icon=L.icon({iconSize:[25,41],iconUrl:e.iconPath+"marker-icon"+i+".png",iconAnchor:[12,41],shadowSize:[41,41],shadowUrl:e.iconPath+"marker-shadow.png",shadowAnchor:[41/3,41],popupAnchor:[0,-35]}),L.marker(t,e)},fadeIn:function(t,e,i,n,o,r){function s(t){segment=e.routeSegments[t],percent="travelTime"==n?segment.getTravelTime()/e.getTravelTime():segment.getDistance()/e.getDistance(),timeToDraw=percent*i,"TRANSFER"!=segment.getType()?g(segment,timeToDraw,o,t):(("undefined"==typeof o||o.paintTransfer||"undefined"!=typeof o&&!a.has(o,"paintTransfer"))&&l(segment,o),++t<e.routeSegments.length&&s(t))}function l(t,e){h(t.points[0],t,e),t.points.length>1&&t.points[0].lat!=t.points[1].lat&&t.points[0].lng!=t.points[1].lng&&h(t.points[1],t,e)}function h(e,i,n){var o=L.circleMarker(e,{color:!a.isUndefined(n)&&a.has(n,"transferColor")?n.transferColor:i.getColor(),fillColor:!a.isUndefined(n)&&a.has(n,"transferHaloColor")?n.transferHaloColor:"undefined"!=typeof i.getHaloColor()?i.getHaloColor():"#9D9D9D",fillOpacity:!a.isUndefined(n)&&a.has(n,"transferFillOpacity")?n.transferFillOpacity:1,opacity:!a.isUndefined(n)&&a.has(n,"transferOpacity")?n.transferOpacity:1,stroke:!a.isUndefined(n)&&a.has(n,"transferStroke")?n.transferStroke:!0,weight:!a.isUndefined(n)&&a.has(n,"transferWeight")?n.transferWeight:4,radius:!a.isUndefined(n)&&a.has(n,"transferRadius")?n.transferRadius:8}),r=!a.isUndefined(n)&&a.has(n,"popup")?n.popup:"INSERT_TEXT";if("undefined"!=typeof i){var s=a.contains(["walk","transit","source","target","bike","car"],i.startname)?"":i.startname;s=""!=s||a.contains(["walk","transit","source","target","bike","car"],i.endname)?s:i.endname,r=r.replace("INSERT_TEXT",s)}!a.isUndefined(n)&&a.has(n,"popup")&&(o.bindPopup(r),o.on("mouseover",function(){o.openPopup()})),o.addTo(t),o.bringToFront()}function g(e,i,n,o){var s={};s.color=!a.isUndefined(n)&&a.has(n,"color")?n.color:e.getColor(),s.opacity=!a.isUndefined(n)&&a.has(n,"opacity")?n.opacity:.8,s.weight=!a.isUndefined(n)&&a.has(n,"weight")?n.weight:5,"TRANSIT"!=e.getType()&&"WALK"==e.getType()&&(s.color=!a.isUndefined(n)&&a.has(n,"walkColor")?n.walkColor:"#006F35",s.weight=!a.isUndefined(n)&&a.has(n,"walkWeight")?n.walkWeight:7,s.dashArray=!a.isUndefined(n)&&a.has(n,"walkDashArray")?n.walkDashArray:"1, 10");var l={};l.weight=!a.isUndefined(n)&&a.has(n,"haloWeight")?n.haloWeight:10,l.opacity=!a.isUndefined(n)&&a.has(n,"haloOpacity")?n.haloOpacity:.7,l.color=!a.isUndefined(n)&&a.has(n,"haloColor")?n.haloColor:"undefined"!=typeof e.getHaloColor()?e.getHaloColor():"#9D9D9D";var h=i/15,g=d(e.getPoints(),h),c=L.polyline(g[0],l).addTo(t),p=L.polyline(g[0],s).addTo(t);c.on("click",r),p.on("click",r),u(p,c,g,1,o)}function u(t,i,n,o,r){for(var a=t.getLatLngs(),l=0;l<n[o].length;l++)a.push(n[o][l]);0!=a.length&&(i.setLatLngs(a),t.setLatLngs(a)),++o<n.length?setTimeout(function(){u(t,i,n,o,r)},15):++r<e.routeSegments.length&&s(r)}function d(t,e){for(var i,n,o=0,r=1/e,a=0,s=new Array,l=1;l<t.length;l++)o+=t[l-1].distanceTo(t[l]);for(var h=new Array,l=0;l<t.length-1;l++)if(h.push(t[l]),i=t[l].distanceTo(t[l+1]),n=i/o,a+=n,a>=r)for(;a>=r;)percent=(r-(a-n))/n,h.push(c(t[l],t[l+1],percent)),r+=1/e,s.push(h),h=new Array;return s.push(h),h=new Array,h.push(t[t.length-1]),s.push(h),s}function c(e,i,n){var o;o="undefined"!=typeof t.project?t:t._map;var r=o.project(e),s=o.project(i),l=(s.x-r.x)*n+r.x,h=(s.y-r.y)*n+r.y,g=new a.point(l,h),u=o.unproject(L.point(g.x,g.y));return u}"undefined"==typeof i&&(i=0),"undefined"==typeof n&&(n="travelTime"),s(0)}},t.google&&(r.prototype=new google.maps.OverlayView,r.prototype.onAdd=function(){this.element=e.createElement("div"),this.element.id="r360-googlemaps-polygon-layer-canvas-in-"+this.id,this.getPanes().overlayLayer.appendChild(this.element)},r.prototype.getMapPixelBounds=function(){var t=a.GoogleMapsUtil.googleLatlngToPoint(this.map,this.map.getBounds().getSouthWest(),this.map.getZoom()),e=a.GoogleMapsUtil.googleLatlngToPoint(this.map,this.map.getBounds().getNorthEast(),this.map.getZoom());return{max:{x:e.x,y:t.y},min:{x:t.x,y:e.y}}},r.prototype.getPixelOrigin=function(){var t=a.PolygonUtil.divide({x:this.map.getDiv().offsetWidth,y:this.map.getDiv().offsetHeight},2),e=a.GoogleMapsUtil.googleLatlngToPoint(this.map,this.map.getCenter(),this.map.getZoom());return a.PolygonUtil.roundPoint(a.PolygonUtil.subtract(e,t.x,t.y))},r.prototype.getBoundingBox3857=function(){return this.multiPolygons[0].getBoundingBox3857()},r.prototype.getBoundingBox4326=function(){return this.multiPolygons[0].getBoundingBox4326()},r.prototype.setInverse=function(t){this.inverse!=t&&(this.inverse=t,this.draw())},r.prototype.createSvgData=function(t){var e=a.SvgUtil.createSvgData(t,{bounds:a.PolygonUtil.extendBounds(this.getMapPixelBounds(),this.extendWidthX,this.extendWidthY),scale:256*Math.pow(2,this.map.getZoom()),tolerance:this.tolerance,pixelOrigin:this.getPixelOrigin(),offset:{x:0,y:0}});return e},r.prototype.setColors=function(t){if("undefined"!=typeof this.multiPolygons){t=t;for(var e=0;e<this.multiPolygons.length;e++){var i=this.multiPolygons[e];t.forEach(function(t){t.time==i.getTravelTime()&&i.setColor(t.color)})}this.draw()}},r.prototype.fitMap=function(){var t=this.getBoundingBox4326(),e=t.getSouthWest(),i=t.getNorthEast(),n=new google.maps.LatLngBounds(new google.maps.LatLng(e.lat,e.lng),new google.maps.LatLng(i.lat,i.lng));this.map.fitBounds(n)},r.prototype.draw=function(t){if("undefined"!=typeof this.multiPolygons&&null!=this.element){this.svgWidth=this.map.getDiv().offsetWidth,this.svgHeight=this.map.getDiv().offsetHeight;var e=$("#svg_"+this.id).offset(),i=$(this.map.getDiv()).offset();"undefined"==typeof this.offset&&(this.offset={x:0,y:0}),"undefined"!=typeof e&&(this.offset.x+=i.left-e.left,this.offset.y+=i.top-e.top),$("#"+this.element.id).empty();for(var n=[],o=0;o<this.multiPolygons.length;o++){for(var r=this.multiPolygons[o],s=[],l=0;l<r.polygons.length;l++)s.push(this.createSvgData(r.polygons[l]));0!=s.length&&n.push(a.SvgUtil.getGElement(s,{color:this.inverse?"black":r.getColor(),opacity:this.inverse?r.getOpacity():1,strokeWidth:this.strokeWidth}))}var h={id:this.id,offset:this.offset,svgHeight:this.svgHeight,svgWidth:this.svgWidth,backgroundColor:this.backgroundColor,backgroundOpacity:this.backgroundOpacity,opacity:this.opacity,strokeWidth:this.strokeWidth};$("#"+this.element.id).append(this.inverse?a.SvgUtil.getInverseSvgElement(n,h):a.SvgUtil.getNormalSvgElement(n,h))}},r.prototype.update=function(t){this.multiPolygons=t,this.draw()},r.prototype.addListener=function(){var e=this.map,i=this;google.maps.event.addListener(e,"zoom_changed",function(){i.onRemove(),google.maps.event.addListenerOnce(e,"idle",function(){i.draw()})}),google.maps.event.addListener(e,"dragend",function(){google.maps.event.addListenerOnce(e,"idle",function(){i.draw()})}),google.maps.event.addDomListener(t,"resize",function(){google.maps.event.trigger(e,"resize"),i.draw()})},r.prototype.onRemove=function(){"undefined"!=typeof this.element&&null!=this.elemenet&&$("#"+this.element.id).empty()},a.googleMapsPolygonLayer=function(t){return"undefined"!=typeof this.element&&null!=this.elemenet?new r(t):void 0}),a.GoogleMapsUtil={googleLatlngToPoint:function(t,e,i){var n=t.getProjection().fromLatLngToPoint(e),o=Math.pow(2,i);return new google.maps.Point(n.x*o,n.y*o)},googlePointToLatlng:function(t,e,i){var n=Math.pow(2,i),o=new google.maps.Point(e.x/n,e.y/n),r=t.getProjection().fromPointToLatLng(o);return r}}}(window,document);